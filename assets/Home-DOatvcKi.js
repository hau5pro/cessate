import{r as c,j as s,B as g,m as X,e as j,D as q}from"./mui-MagnalEl.js";import{C as J,u as v,d as T,t as Z,a as tt,g as et,b as K,c as N,e as D,f as z,L as nt,r as F,l as st,s as ot}from"./index-rHyibTkR.js";import{M as at,u as $,P as rt,a as it,b as W,L as lt,c as ct,s as Q,m as M}from"./proxy-Bgyb-AjX.js";import{B as U}from"./BaseButton-ne2w8NBM.js";import{T as ut}from"./firebase-CZ1iWosV.js";class dt extends c.Component{getSnapshotBeforeUpdate(n){const e=this.props.childRef.current;if(e&&n.isPresent&&!this.props.isPresent){const o=e.offsetParent,i=o instanceof HTMLElement&&o.offsetWidth||0,r=this.props.sizeRef.current;r.height=e.offsetHeight||0,r.width=e.offsetWidth||0,r.top=e.offsetTop,r.left=e.offsetLeft,r.right=i-r.width-r.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ht({children:t,isPresent:n,anchorX:e}){const o=c.useId(),i=c.useRef(null),r=c.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:a}=c.useContext(at);return c.useInsertionEffect(()=>{const{width:y,height:u,top:f,left:d,right:h}=r.current;if(n||!i.current||!y||!u)return;const x=e==="left"?`left: ${d}`:`right: ${h}`;i.current.dataset.motionPopId=o;const p=document.createElement("style");return a&&(p.nonce=a),document.head.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${u}px !important;
            ${x}px !important;
            top: ${f}px !important;
          }
        `),()=>{document.head.contains(p)&&document.head.removeChild(p)}},[n]),s.jsx(dt,{isPresent:n,childRef:i,sizeRef:r,children:c.cloneElement(t,{ref:i})})}const ft=({children:t,initial:n,isPresent:e,onExitComplete:o,custom:i,presenceAffectsLayout:r,mode:a,anchorX:y})=>{const u=$(pt),f=c.useId();let d=!0,h=c.useMemo(()=>(d=!1,{id:f,initial:n,isPresent:e,custom:i,onExitComplete:x=>{u.set(x,!0);for(const p of u.values())if(!p)return;o&&o()},register:x=>(u.set(x,!1),()=>u.delete(x))}),[e,u,o]);return r&&d&&(h={...h}),c.useMemo(()=>{u.forEach((x,p)=>u.set(p,!1))},[e]),c.useEffect(()=>{!e&&!u.size&&o&&o()},[e]),a==="popLayout"&&(t=s.jsx(ht,{isPresent:e,anchorX:y,children:t})),s.jsx(rt.Provider,{value:h,children:t})};function pt(){return new Map}const P=t=>t.key||"";function G(t){const n=[];return c.Children.forEach(t,e=>{c.isValidElement(e)&&n.push(e)}),n}const yt=({children:t,custom:n,initial:e=!0,onExitComplete:o,presenceAffectsLayout:i=!0,mode:r="sync",propagate:a=!1,anchorX:y="left"})=>{const[u,f]=it(a),d=c.useMemo(()=>G(t),[t]),h=a&&!u?[]:d.map(P),x=c.useRef(!0),p=c.useRef(d),C=$(()=>new Map),[l,S]=c.useState(d),[b,E]=c.useState(d);W(()=>{x.current=!1,p.current=d;for(let w=0;w<b.length;w++){const m=P(b[w]);h.includes(m)?C.delete(m):C.get(m)!==!0&&C.set(m,!1)}},[b,h.length,h.join("-")]);const k=[];if(d!==l){let w=[...d];for(let m=0;m<b.length;m++){const R=b[m],L=P(R);h.includes(L)||(w.splice(m,0,R),k.push(R))}return r==="wait"&&k.length&&(w=k),E(G(w)),S(d),null}const{forceRender:I}=c.useContext(lt);return s.jsx(s.Fragment,{children:b.map(w=>{const m=P(w),R=a&&!u?!1:d===b||h.includes(m),L=()=>{if(C.has(m))C.set(m,!0);else return;let _=!0;C.forEach(O=>{O||(_=!1)}),_&&(I==null||I(),E(p.current),a&&(f==null||f()),o&&o())};return s.jsx(ft,{isPresent:R,initial:!x.current||e?void 0:!1,custom:n,presenceAffectsLayout:i,mode:r,onExitComplete:R?void 0:L,anchorX:y,children:w},m)})})};function mt(t){t.values.forEach(n=>n.stop())}function B(t,n){[...n].reverse().forEach(o=>{const i=t.getVariant(o);i&&Q(t,i),t.variantChildren&&t.variantChildren.forEach(r=>{B(r,n)})})}function xt(t,n){if(Array.isArray(n))return B(t,n);if(typeof n=="string")return B(t,[n]);Q(t,n)}function gt(){const t=new Set,n={subscribe(e){return t.add(e),()=>void t.delete(e)},start(e,o){const i=[];return t.forEach(r=>{i.push(ct(r,e,{transitionOverride:o}))}),Promise.all(i)},set(e){return t.forEach(o=>{xt(o,e)})},stop(){t.forEach(e=>{mt(e)})},mount(){return()=>{n.stop()}}};return n}function Ct(){const t=$(gt);return W(t.mount,[]),t}const H=Ct,St=X`
  0% {
    transform: translateX(-100%);
    opacity: 0;
  }
  25% {
    opacity: 1;
  }
  75% {
    opacity: 1;
  }
  100% {
    transform: translateX(100%);
    opacity: 0;
  }
`,wt=({percent:t,width:n="100%",animate:e=!1,sx:o,...i})=>s.jsx(g,{sx:{position:"relative",width:n,height:5,borderRadius:5,overflow:"hidden",backgroundColor:"rgba(255,255,255,0.1)",...o},...i,children:s.jsx(g,{sx:{width:`${t}%`,height:"100%",backgroundColor:J.interpolateColor(t/100),borderRadius:5,transition:"width 0.5s ease, background-color 0.3s ease",position:"relative",overflow:"hidden",...e&&t!==100&&{"&::after":{content:'""',position:"absolute",top:0,left:"-100%",width:"200%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:`${St} 2.5s ease-in-out infinite`,pointerEvents:"none"}}}})});T.extend(tt);const vt={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}},exit:{opacity:0,y:-20,transition:{duration:.3}}};function bt(){const t=v(h=>h.currentSession),[n,e]=c.useState(T());if(c.useEffect(()=>{const h=setInterval(()=>e(T()),1e3);return()=>clearInterval(h)},[]),!t||!t.createdAt)return null;const o=t.createdAt.toDate(),i=T(o).add(t.targetDuration,"second"),r=T.duration(Math.max(i.diff(n),0)),a=T.duration(Math.max(n.diff(o),0)),y=a.asSeconds(),u=t.targetDuration,f=u>0?Math.min(100,Math.max(0,y/u*100)):0,d=f/100;return s.jsx(yt,{children:s.jsx(M.div,{initial:"hidden",animate:"visible",exit:"exit",variants:vt,children:s.jsxs(g,{textAlign:"center",p:1,sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:.5,flexGrow:1},children:[s.jsx(j,{variant:"h3",color:"secondary",mt:1,children:"You've abstained for"}),s.jsxs(j,{variant:"h2",color:Z.palette.common.white,sx:{fontSize:"3rem"},children:[a.days(),"d ",a.hours(),"h ",a.minutes(),"m"]}),s.jsx(j,{variant:"body1",color:"secondary",mt:2,children:"Time remaining"}),s.jsx(j,{variant:"subtitle1",children:r.format("HH:mm:ss")}),s.jsxs(g,{textAlign:"center",p:2,sx:{display:"flex",flexDirection:"column",gap:1},children:[s.jsx(wt,{percent:f,width:"60%",animate:!0,sx:{alignSelf:"center"}}),s.jsxs(j,{variant:"body2",display:"block",mt:1,children:[s.jsxs("span",{style:{color:J.interpolateColor(d)},children:[Math.floor(f),"%"]})," ","of your target completed",r.asSeconds()===0?"!":""]})]})]})},"current-session")})}const V=[{text:"The secret of getting ahead is getting started.",author:"Mark Twain"},{text:"It always seems impossible until it’s done.",author:"Nelson Mandela"},{text:"You are never too old to set another goal or to dream a new dream.",author:"C.S. Lewis"},{text:"The greatest wealth is health.",author:"Virgil"},{text:"Your life does not get better by chance, it gets better by change.",author:"Jim Rohn"},{text:"Health is not valued till sickness comes.",author:"Thomas Fuller"},{text:"Don’t let yesterday take up too much of today.",author:"Will Rogers"},{text:"It is health that is real wealth and not pieces of gold and silver.",author:"Mahatma Gandhi"},{text:"Take care of your body. It’s the only place you have to live.",author:"Jim Rohn"},{text:"Courage is resistance to fear, mastery of fear – not absence of fear.",author:"Mark Twain"},{text:"The only way to achieve the impossible is to believe it is possible.",author:"Charles Kingsleigh"},{text:"Fall seven times, stand up eight.",author:"Japanese Proverb"},{text:"Strength does not come from physical capacity. It comes from an indomitable will.",author:"Mahatma Gandhi"},{text:"The first step towards getting somewhere is to decide you’re not going to stay where you are.",author:"J.P. Morgan"},{text:"The journey of a thousand miles begins with one step.",author:"Lao Tzu"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{text:"Believe you can, and you’re halfway there.",author:"Theodore Roosevelt"},{text:"You don’t have to see the whole staircase. Just take the first step.",author:"Martin Luther King"},{text:"If you do what you’ve always done, you’ll get what you’ve always gotten.",author:"Tony Robbins"},{text:"It doesn’t matter how slowly you go, only that you do not stop.",author:"Confucius"},{text:"If we are facing in the right direction, all we have to do is keep on walking.",author:"Zen Proverb"},{text:"It does not matter how slowly you go as long as you do not stop.",author:"Confucius"}],Y=()=>V[Math.floor(Math.random()*V.length)],jt=({controls:t})=>{const[n,e]=c.useState(Y());c.useEffect(()=>{e(Y())},[]);const o=n.text.split(" ");return s.jsxs(g,{textAlign:"center",sx:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,padding:2},children:[s.jsx(j,{variant:"h3",gutterBottom:!0,children:s.jsx(g,{component:"span",display:"inline-block",children:o.map((i,r)=>s.jsx(M.span,{initial:{opacity:0,y:10},animate:t,transition:{delay:r*.15},style:{display:"inline-block",marginRight:"6px"},children:i},r))})}),s.jsx(M.div,{initial:{opacity:0},animate:t,transition:{delay:o.length*.15+.5},children:s.jsxs(j,{variant:"body1",color:"textSecondary",mt:1,children:["— ",n.author]})})]})};function Rt(){const t=et(),n=K(l=>l.user),e=N(l=>{var S;return(S=l.settings)==null?void 0:S.targetDuration}),o=v(l=>l.currentSession),i=v(l=>l.setCurrentSession),r=v(l=>l.loading),a=v(l=>l.setLoading),y=D(l=>l.sessionGaps.data.find(S=>S.day===t)),u=D(l=>l.updateTodaySessionGapSummary),f=D(l=>l.dailySessions.data.find(S=>S.day===t)),d=D(l=>l.updateTodayDailySession),h=z(l=>l.updateSession),x=z(l=>l.addSession),p=async()=>{if(!(!n||!(o!=null&&o.id)||!e))try{a(!0);const{session:l,previous:S,gapSummary:b}=await F(async k=>st(n.uid,o,e,k,y));u(b);const E=((f==null?void 0:f.count)??0)+1;d({day:t,count:E,updatedAt:ut.now()}),h(S),x(l),i(l)}catch(l){console.error("Relapse failed:",l)}finally{a(!1)}},C="0.3em";return s.jsxs(U,{sx:{minHeight:"56px",position:"relative"},color:"secondary",onClick:p,disabled:r,children:[s.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",children:s.jsxs("span",{style:{fontFamily:"Roboto, sans-serif",letterSpacing:C,display:"inline-block"},children:["R",s.jsx("span",{style:{transform:"rotateY(180deg)",display:"inline-block",margin:`0 ${C} 0 -${C}`},children:"e"}),"lapse"]})}),s.jsx(g,{sx:{position:"absolute",right:24,top:"50%",transform:"translateY(-50%)",opacity:r?1:0,transition:"opacity 0.2s ease",pointerEvents:"none"},children:s.jsx(nt,{size:30})})]})}function Tt(){const t=K(a=>a.user),n=N(a=>a.settings),e=v(a=>a.setCurrentSession),o=v(a=>a.setLoading),i=z(a=>a.addSession),r=async()=>{if(!(!t||!(n!=null&&n.targetDuration)))try{o(!0);const a=await F(async y=>ot(t.uid,n.targetDuration,y));e({...a}),i(a)}catch(a){console.error("Failed to start session:",a)}finally{o(!1)}};return s.jsx(U,{variant:"contained",color:"primary",onClick:r,children:"Start Your Journey"})}const kt="_HomeContainer_az91x_1",Mt="_ScrollContainer_az91x_10",Et="_ButtonContainer_az91x_20",A={HomeContainer:kt,ScrollContainer:Mt,ButtonContainer:Et};function At(){const t=v(u=>u.currentSession),n=v(u=>u.loading),e=v(u=>u.hasInitialized),o=H(),i=H(),r=H(),[a,y]=c.useState(!1);return c.useEffect(()=>{e&&y(!0)},[e]),c.useEffect(()=>{a&&(o.start({y:0,opacity:1}),setTimeout(()=>{i.start({y:0,opacity:1})},200),setTimeout(()=>{r.start({opacity:1})},1e3))},[a,o,i,r]),e?s.jsxs(g,{className:A.HomeContainer,children:[s.jsxs(g,{className:A.ScrollContainer,children:[s.jsx(M.div,{initial:{y:-20,opacity:0},animate:o,transition:{duration:.5,ease:"easeOut"},children:s.jsx(bt,{})}),s.jsx(q,{}),s.jsx(jt,{controls:r})]}),s.jsx(g,{className:A.ButtonContainer,children:s.jsx(M.div,{initial:{y:40,opacity:0},animate:i,transition:{duration:.5,ease:"easeOut"},style:{width:"100%"},children:!n&&!t?s.jsx(Tt,{}):s.jsx(Rt,{})})})]}):null}export{At as default};
