import{r as l,j as o,B as g,m as X,e as j,D as q}from"./mui-MagnalEl.js";import{C as J,u as v,d as T,t as Z,a as tt,g as et,b as K,c as N,e as D,f as _,L as nt,r as F,l as st,s as ot}from"./index-BGNx3duG.js";import{M as at,u as B,P as rt,a as it,b as W,L as lt,c as ct,s as Q,m as M}from"./proxy-Bgyb-AjX.js";import{B as U}from"./BaseButton-ne2w8NBM.js";import{T as ut}from"./firebase-CZ1iWosV.js";class dt extends l.Component{getSnapshotBeforeUpdate(n){const e=this.props.childRef.current;if(e&&n.isPresent&&!this.props.isPresent){const a=e.offsetParent,r=a instanceof HTMLElement&&a.offsetWidth||0,s=this.props.sizeRef.current;s.height=e.offsetHeight||0,s.width=e.offsetWidth||0,s.top=e.offsetTop,s.left=e.offsetLeft,s.right=r-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ht({children:t,isPresent:n,anchorX:e}){const a=l.useId(),r=l.useRef(null),s=l.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:u}=l.useContext(at);return l.useInsertionEffect(()=>{const{width:m,height:c,top:f,left:d,right:h}=s.current;if(n||!r.current||!m||!c)return;const x=e==="left"?`left: ${d}`:`right: ${h}`;r.current.dataset.motionPopId=a;const p=document.createElement("style");return u&&(p.nonce=u),document.head.appendChild(p),p.sheet&&p.sheet.insertRule(`
          [data-motion-pop-id="${a}"] {
            position: absolute !important;
            width: ${m}px !important;
            height: ${c}px !important;
            ${x}px !important;
            top: ${f}px !important;
          }
        `),()=>{document.head.contains(p)&&document.head.removeChild(p)}},[n]),o.jsx(dt,{isPresent:n,childRef:r,sizeRef:s,children:l.cloneElement(t,{ref:r})})}const ft=({children:t,initial:n,isPresent:e,onExitComplete:a,custom:r,presenceAffectsLayout:s,mode:u,anchorX:m})=>{const c=B(pt),f=l.useId();let d=!0,h=l.useMemo(()=>(d=!1,{id:f,initial:n,isPresent:e,custom:r,onExitComplete:x=>{c.set(x,!0);for(const p of c.values())if(!p)return;a&&a()},register:x=>(c.set(x,!1),()=>c.delete(x))}),[e,c,a]);return s&&d&&(h={...h}),l.useMemo(()=>{c.forEach((x,p)=>c.set(p,!1))},[e]),l.useEffect(()=>{!e&&!c.size&&a&&a()},[e]),u==="popLayout"&&(t=o.jsx(ht,{isPresent:e,anchorX:m,children:t})),o.jsx(rt.Provider,{value:h,children:t})};function pt(){return new Map}const P=t=>t.key||"";function G(t){const n=[];return l.Children.forEach(t,e=>{l.isValidElement(e)&&n.push(e)}),n}const yt=({children:t,custom:n,initial:e=!0,onExitComplete:a,presenceAffectsLayout:r=!0,mode:s="sync",propagate:u=!1,anchorX:m="left"})=>{const[c,f]=it(u),d=l.useMemo(()=>G(t),[t]),h=u&&!c?[]:d.map(P),x=l.useRef(!0),p=l.useRef(d),C=B(()=>new Map),[i,w]=l.useState(d),[b,E]=l.useState(d);W(()=>{x.current=!1,p.current=d;for(let S=0;S<b.length;S++){const y=P(b[S]);h.includes(y)?C.delete(y):C.get(y)!==!0&&C.set(y,!1)}},[b,h.length,h.join("-")]);const k=[];if(d!==i){let S=[...d];for(let y=0;y<b.length;y++){const R=b[y],L=P(R);h.includes(L)||(S.splice(y,0,R),k.push(R))}return s==="wait"&&k.length&&(S=k),E(G(S)),w(d),null}const{forceRender:I}=l.useContext(lt);return o.jsx(o.Fragment,{children:b.map(S=>{const y=P(S),R=u&&!c?!1:d===b||h.includes(y),L=()=>{if(C.has(y))C.set(y,!0);else return;let $=!0;C.forEach(O=>{O||($=!1)}),$&&(I==null||I(),E(p.current),u&&(f==null||f()),a&&a())};return o.jsx(ft,{isPresent:R,initial:!x.current||e?void 0:!1,custom:n,presenceAffectsLayout:r,mode:s,onExitComplete:R?void 0:L,anchorX:m,children:S},y)})})};function mt(t){t.values.forEach(n=>n.stop())}function z(t,n){[...n].reverse().forEach(a=>{const r=t.getVariant(a);r&&Q(t,r),t.variantChildren&&t.variantChildren.forEach(s=>{z(s,n)})})}function xt(t,n){if(Array.isArray(n))return z(t,n);if(typeof n=="string")return z(t,[n]);Q(t,n)}function gt(){const t=new Set,n={subscribe(e){return t.add(e),()=>void t.delete(e)},start(e,a){const r=[];return t.forEach(s=>{r.push(ct(s,e,{transitionOverride:a}))}),Promise.all(r)},set(e){return t.forEach(a=>{xt(a,e)})},stop(){t.forEach(e=>{mt(e)})},mount(){return()=>{n.stop()}}};return n}function Ct(){const t=B(gt);return W(t.mount,[]),t}const A=Ct,wt=X`
  0% {
    transform: translateX(-100%);
    opacity: 0;
  }
  25% {
    opacity: 1;
  }
  75% {
    opacity: 1;
  }
  100% {
    transform: translateX(100%);
    opacity: 0;
  }
`,St=({percent:t,width:n="100%",animate:e=!1,sx:a,...r})=>o.jsx(g,{sx:{position:"relative",width:n,height:5,borderRadius:5,overflow:"hidden",backgroundColor:"rgba(255,255,255,0.1)",...a},...r,children:o.jsx(g,{sx:{width:`${t}%`,height:"100%",backgroundColor:J.interpolateColor(t/100),borderRadius:5,transition:"width 0.5s ease, background-color 0.3s ease",position:"relative",overflow:"hidden",...e&&t!==100&&{"&::after":{content:'""',position:"absolute",top:0,left:"-100%",width:"200%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:`${wt} 2.5s ease-in-out infinite`,pointerEvents:"none"}}}})});T.extend(tt);const vt={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}},exit:{opacity:0,y:-20,transition:{duration:.3}}};function bt(){const t=v(h=>h.currentSession),[n,e]=l.useState(T());if(l.useEffect(()=>{const h=setInterval(()=>e(T()),1e3);return()=>clearInterval(h)},[]),!t||!t.createdAt)return null;const a=t.createdAt.toDate(),r=T(a).add(t.targetDuration,"second"),s=T.duration(Math.max(r.diff(n),0)),u=T.duration(Math.max(n.diff(a),0)),m=u.asSeconds(),c=t.targetDuration,f=c>0?Math.min(100,Math.max(0,m/c*100)):0,d=f/100;return o.jsx(yt,{children:o.jsx(M.div,{initial:"hidden",animate:"visible",exit:"exit",variants:vt,children:o.jsxs(g,{textAlign:"center",p:1,sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:.5,flexGrow:1},children:[o.jsx(j,{variant:"h3",color:"secondary",mt:1,children:"You've abstained for"}),o.jsxs(j,{variant:"h2",color:Z.palette.common.white,sx:{fontSize:"3rem"},children:[u.days(),"d ",u.hours(),"h ",u.minutes(),"m"]}),o.jsx(j,{variant:"body1",color:"secondary",mt:2,children:"Time remaining"}),o.jsx(j,{variant:"subtitle1",children:s.format("HH:mm:ss")}),o.jsxs(g,{textAlign:"center",p:2,sx:{display:"flex",flexDirection:"column",gap:1},children:[o.jsx(St,{percent:f,width:"60%",animate:!0,sx:{alignSelf:"center"}}),o.jsxs(j,{variant:"body2",display:"block",mt:1,children:[o.jsxs("span",{style:{color:J.interpolateColor(d)},children:[Math.floor(f),"%"]})," ","of your target completed",s.asSeconds()===0?"!":""]})]})]})},"current-session")})}const V=[{text:"The secret of getting ahead is getting started.",author:"Mark Twain"},{text:"It always seems impossible until it’s done.",author:"Nelson Mandela"},{text:"You are never too old to set another goal or to dream a new dream.",author:"C.S. Lewis"},{text:"The greatest wealth is health.",author:"Virgil"},{text:"Your life does not get better by chance, it gets better by change.",author:"Jim Rohn"},{text:"Health is not valued till sickness comes.",author:"Thomas Fuller"},{text:"Don’t let yesterday take up too much of today.",author:"Will Rogers"},{text:"It is health that is real wealth and not pieces of gold and silver.",author:"Mahatma Gandhi"},{text:"Take care of your body. It’s the only place you have to live.",author:"Jim Rohn"},{text:"Courage is resistance to fear, mastery of fear – not absence of fear.",author:"Mark Twain"},{text:"The only way to achieve the impossible is to believe it is possible.",author:"Charles Kingsleigh"},{text:"Fall seven times, stand up eight.",author:"Japanese Proverb"},{text:"Strength does not come from physical capacity. It comes from an indomitable will.",author:"Mahatma Gandhi"},{text:"The first step towards getting somewhere is to decide you’re not going to stay where you are.",author:"J.P. Morgan"},{text:"The journey of a thousand miles begins with one step.",author:"Lao Tzu"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{text:"Believe you can, and you’re halfway there.",author:"Theodore Roosevelt"},{text:"You don’t have to see the whole staircase. Just take the first step.",author:"Martin Luther King"},{text:"If you do what you’ve always done, you’ll get what you’ve always gotten.",author:"Tony Robbins"},{text:"It doesn’t matter how slowly you go, only that you do not stop.",author:"Confucius"},{text:"If we are facing in the right direction, all we have to do is keep on walking.",author:"Zen Proverb"},{text:"It does not matter how slowly you go as long as you do not stop.",author:"Confucius"}],Y=()=>V[Math.floor(Math.random()*V.length)],jt=({controls:t})=>{const[n,e]=l.useState(Y());l.useEffect(()=>{e(Y())},[]);const a=n.text.split(" ");return o.jsxs(g,{textAlign:"center",sx:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,padding:2},children:[o.jsx(j,{variant:"h3",gutterBottom:!0,children:o.jsx(g,{component:"span",display:"inline-block",children:a.map((r,s)=>o.jsx(M.span,{initial:{opacity:0,y:10},animate:t,transition:{delay:s*.15},style:{display:"inline-block",marginRight:"6px"},children:r},s))})}),o.jsx(M.div,{initial:{opacity:0},animate:t,transition:{delay:a.length*.15+.5},children:o.jsxs(j,{variant:"body1",color:"textSecondary",mt:1,children:["— ",n.author]})})]})};function Rt(){const t=et(),n=K(i=>i.user),e=N(i=>{var w;return(w=i.settings)==null?void 0:w.targetDuration}),a=v(i=>i.currentSession),r=v(i=>i.setCurrentSession),s=v(i=>i.loading),u=v(i=>i.setLoading),m=D(i=>i.sessionGaps.data.find(w=>w.day===t)),c=D(i=>i.updateTodaySessionGapSummary),f=D(i=>i.dailySessions.data.find(w=>w.day===t)),d=D(i=>i.updateTodayDailySession),h=_(i=>i.updateSession),x=_(i=>i.addSession),p=async()=>{if(!(!n||!(a!=null&&a.id)||!e))try{u(!0);const{session:i,previous:w,gapSummary:b}=await F(async k=>st(n.uid,a,e,k,m));c(b);const E=((f==null?void 0:f.count)??0)+1;d({day:t,count:E,updatedAt:ut.now()}),h(w),x(i),r(i)}catch(i){console.error("Relapse failed:",i)}finally{u(!1)}},C="0.3em";return o.jsxs(U,{sx:{minHeight:"56px",position:"relative"},color:"secondary",onClick:p,disabled:s,children:[o.jsx(g,{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",children:o.jsxs("span",{style:{fontFamily:"Roboto, sans-serif",letterSpacing:C,display:"inline-block"},children:["R",o.jsx("span",{style:{transform:"rotateY(180deg)",display:"inline-block",margin:`0 ${C} 0 -${C}`},children:"e"}),"lapse"]})}),o.jsx(g,{sx:{position:"absolute",right:24,top:"50%",transform:"translateY(-50%)",opacity:s?1:0,transition:"opacity 0.2s ease",pointerEvents:"none"},children:o.jsx(nt,{size:30})})]})}function Tt(){const t=K(s=>s.user),n=N(s=>s.settings),e=v(s=>s.setCurrentSession),a=v(s=>s.setLoading),r=async()=>{if(!(!t||!(n!=null&&n.targetDuration)))try{a(!0);const s=await F(async u=>ot(t.uid,n.targetDuration,u));e({...s})}catch(s){console.error("Failed to start session:",s)}finally{a(!1)}};return o.jsx(U,{variant:"contained",color:"primary",onClick:r,children:"Start Your Journey"})}const kt="_HomeContainer_az91x_1",Mt="_ScrollContainer_az91x_10",Et="_ButtonContainer_az91x_20",H={HomeContainer:kt,ScrollContainer:Mt,ButtonContainer:Et};function Ht(){const t=v(c=>c.currentSession),n=v(c=>c.loading),e=v(c=>c.hasInitialized),a=A(),r=A(),s=A(),[u,m]=l.useState(!1);return l.useEffect(()=>{e&&m(!0)},[e]),l.useEffect(()=>{u&&(a.start({y:0,opacity:1}),setTimeout(()=>{r.start({y:0,opacity:1})},200),setTimeout(()=>{s.start({opacity:1})},1e3))},[u,a,r,s]),e?o.jsxs(g,{className:H.HomeContainer,children:[o.jsxs(g,{className:H.ScrollContainer,children:[o.jsx(M.div,{initial:{y:-20,opacity:0},animate:a,transition:{duration:.5,ease:"easeOut"},children:o.jsx(bt,{})}),o.jsx(q,{}),o.jsx(jt,{controls:s})]}),o.jsx(g,{className:H.ButtonContainer,children:o.jsx(M.div,{initial:{y:40,opacity:0},animate:r,transition:{duration:.5,ease:"easeOut"},style:{width:"100%"},children:!n&&!t?o.jsx(Tt,{}):o.jsx(Rt,{})})})]}):null}export{Ht as default};
