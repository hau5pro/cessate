var b=Object.defineProperty;var N=(e,s,n)=>s in e?b(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n;var C=(e,s,n)=>N(e,typeof s!="symbol"?s+"":s,n);import{j as t,B as a,e as i,x as E,r as _,d as v}from"./mui-MagnalEl.js";import{j as H,d as p,t as m,f as A,b as D,L}from"./index-BGNx3duG.js";import{g}from"./GlobalStyles.module-D1S20KA9.js";import"./firebase-CZ1iWosV.js";class h{static isStale(s){return Date.now()-s>H.ONE_DAY_IN_MS}static debounce(s,n){let r=null;return(...c)=>{r&&clearTimeout(r),r=setTimeout(()=>s(...c),n)}}}C(h,"DEBOUNCE_DELAY",300);const M="_Card_1ron9_1",T="_Section_1ron9_16",Y="_CenterText_1ron9_30",x={Card:M,Section:T,CenterText:Y};function I({session:e}){var o;const s=e.createdAt.toDate(),n=e.endedAt?(o=e.endedAt)==null?void 0:o.toDate():null,r=p(s).format("MMM D, YYYY"),c=p(s).format("h:mm A"),u=e.duration,l=e.percentage,d=e.color??m.palette.secondary.main;return t.jsxs(a,{className:x.Card,children:[t.jsxs(a,{className:x.Section,children:[t.jsx(i,{className:x.CenterText,variant:"body1",color:m.palette.secondary.main,children:r}),t.jsx(i,{variant:"subtitle2",color:m.palette.secondary.main,children:c})]}),t.jsxs(a,{className:x.Section,children:[l!==null?t.jsxs(a,{className:x.Section,children:[t.jsx(i,{variant:"body2",sx:{fontSize:14},color:d,children:`${l}%`}),t.jsx(E,{variant:"determinate",value:l,sx:{width:"100px",borderRadius:4,backgroundColor:"rgba(0, 0, 0, 0.1)",height:4,"& .MuiLinearProgress-bar":{backgroundColor:d}}})]}):t.jsx(a,{}),t.jsx(i,{variant:"body2",sx:{fontSize:14},color:m.palette.primary.main,children:n?`Lasted ${p.duration(u||0,"seconds").humanize()}`:"Session in progress"})]})]})}const z="_HistoryContainer_1fpjc_1",B="_HistoryContent_1fpjc_9",O="_EmptyState_1fpjc_18",j={HistoryContainer:z,HistoryContent:B,EmptyState:O};function q(){const{sessions:e,hasInitialized:s,hasMore:n,loading:r,loadMore:c}=A(),u=D(o=>o.user),l=_.useRef(null),d=s&&e.length===0;return _.useEffect(()=>{if(!u||!n||r)return;const o=h.debounce(()=>{c(u.uid)},h.DEBOUNCE_DELAY),f=new IntersectionObserver(S=>{S[0].isIntersecting&&o()}),y=l.current;return y&&f.observe(y),()=>{y&&f.unobserve(y)}},[u,n,r,c]),t.jsxs(a,{className:j.HistoryContainer,children:[t.jsxs(i,{className:g.Header,variant:"h2",children:[t.jsx(v,{className:g.MaterialIcon,fontSize:"large"}),"History"]}),t.jsxs(a,{className:j.HistoryContent,children:[d&&t.jsx(R,{}),!d&&e.map(o=>t.jsx(I,{session:o},o.id)),n&&t.jsx("div",{ref:l,style:{height:1}}),r&&!d&&t.jsx(L,{})]})]})}function R(){return t.jsxs(a,{className:j.EmptyState,children:[t.jsx(i,{variant:"h5",color:m.palette.secondary.main,sx:{mt:4,textAlign:"center"},children:"No past sessions yet."}),t.jsx(i,{variant:"body2",color:m.palette.secondary.main,sx:{mt:1,textAlign:"center",opacity:.7},children:"Start a session to begin your journey."})]})}export{q as default};
