import{j as e,B as u,m as _,r as p,e as f,D as V}from"./mui-MagnalEl.js";import{a as Y,s as R,u as G,b as J,C as I,c as d,d as g,A as N,m as S,t as F,e as K,f as H,g as M,h as C,L as Q,i as $,j as b,r as B,l as q,k as O}from"./index-4H7UTGN2.js";import{B as L}from"./BaseButton-BiFJ8O7b.js";import{T as U}from"./firebase-CZ1iWosV.js";function W(t){t.values.forEach(o=>o.stop())}function T(t,o){[...o].reverse().forEach(r=>{const i=t.getVariant(r);i&&R(t,i),t.variantChildren&&t.variantChildren.forEach(l=>{T(l,o)})})}function X(t,o){if(Array.isArray(o))return T(t,o);if(typeof o=="string")return T(t,[o]);R(t,o)}function Z(){const t=new Set,o={subscribe(s){return t.add(s),()=>void t.delete(s)},start(s,r){const i=[];return t.forEach(l=>{i.push(Y(l,s,{transitionOverride:r}))}),Promise.all(i)},set(s){return t.forEach(r=>{X(r,s)})},stop(){t.forEach(s=>{W(s)})},mount(){return()=>{o.stop()}}};return o}function tt(){const t=G(Z);return J(t.mount,[]),t}const v=tt,et=_`
  0% {
    transform: translateX(-100%);
    opacity: 0;
  }
  25% {
    opacity: 1;
  }
  75% {
    opacity: 1;
  }
  100% {
    transform: translateX(100%);
    opacity: 0;
  }
`,ot=({percent:t,width:o="100%",animate:s=!1,sx:r,...i})=>e.jsx(u,{sx:{position:"relative",width:o,height:5,borderRadius:5,overflow:"hidden",backgroundColor:"rgba(255,255,255,0.1)",...r},...i,children:e.jsx(u,{sx:{width:`${t}%`,height:"100%",backgroundColor:I.interpolateColor(t/100),borderRadius:5,transition:"width 0.5s ease, background-color 0.3s ease",position:"relative",overflow:"hidden",...s&&t!==100&&{"&::after":{content:'""',position:"absolute",top:0,left:"-100%",width:"200%",height:"100%",background:"linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent)",animation:`${et} 2.5s ease-in-out infinite`,pointerEvents:"none"}}}})});g.extend(K);const st={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}},exit:{opacity:0,y:-20,transition:{duration:.3}}};function at(){const t=d(y=>y.currentSession),[o,s]=p.useState(g());if(p.useEffect(()=>{const y=setInterval(()=>s(g()),1e3);return()=>clearInterval(y)},[]),!t||!t.createdAt)return null;const r=t.createdAt.toDate(),i=g(r).add(t.targetDuration,"second"),l=g.duration(Math.max(i.diff(o),0)),n=g.duration(Math.max(o.diff(r),0)),m=n.asSeconds(),c=t.targetDuration,h=c>0?Math.min(100,Math.max(0,m/c*100)):0,a=h/100;return e.jsx(N,{children:e.jsx(S.div,{initial:"hidden",animate:"visible",exit:"exit",variants:st,children:e.jsxs(u,{textAlign:"center",p:1,sx:{display:"flex",flexDirection:"column",justifyContent:"center",gap:.5,flexGrow:1},children:[e.jsx(f,{variant:"h3",color:"secondary",mt:1,children:"You've abstained for"}),e.jsxs(f,{variant:"h2",color:F.palette.common.white,sx:{fontSize:"3rem"},children:[n.days(),"d ",n.hours(),"h ",n.minutes(),"m"]}),e.jsx(f,{variant:"body1",color:"secondary",mt:2,children:"Time remaining"}),e.jsx(f,{variant:"subtitle1",children:l.format("HH:mm:ss")}),e.jsxs(u,{textAlign:"center",p:2,sx:{display:"flex",flexDirection:"column",gap:1},children:[e.jsx(ot,{percent:h,width:"60%",animate:!0,sx:{alignSelf:"center"}}),e.jsxs(f,{variant:"body2",display:"block",mt:1,children:[e.jsxs("span",{style:{color:I.interpolateColor(a)},children:[Math.floor(h),"%"]})," ","of your target completed",l.asSeconds()===0?"!":""]})]})]})},"current-session")})}const A=[{text:"The secret of getting ahead is getting started.",author:"Mark Twain"},{text:"It always seems impossible until it’s done.",author:"Nelson Mandela"},{text:"You are never too old to set another goal or to dream a new dream.",author:"C.S. Lewis"},{text:"The greatest wealth is health.",author:"Virgil"},{text:"Your life does not get better by chance, it gets better by change.",author:"Jim Rohn"},{text:"Health is not valued till sickness comes.",author:"Thomas Fuller"},{text:"Don’t let yesterday take up too much of today.",author:"Will Rogers"},{text:"It is health that is real wealth and not pieces of gold and silver.",author:"Mahatma Gandhi"},{text:"Take care of your body. It’s the only place you have to live.",author:"Jim Rohn"},{text:"Courage is resistance to fear, mastery of fear – not absence of fear.",author:"Mark Twain"},{text:"The only way to achieve the impossible is to believe it is possible.",author:"Charles Kingsleigh"},{text:"Fall seven times, stand up eight.",author:"Japanese Proverb"},{text:"Strength does not come from physical capacity. It comes from an indomitable will.",author:"Mahatma Gandhi"},{text:"The first step towards getting somewhere is to decide you’re not going to stay where you are.",author:"J.P. Morgan"},{text:"The journey of a thousand miles begins with one step.",author:"Lao Tzu"},{text:"Success is not final, failure is not fatal: it is the courage to continue that counts.",author:"Winston Churchill"},{text:"Believe you can, and you’re halfway there.",author:"Theodore Roosevelt"},{text:"You don’t have to see the whole staircase. Just take the first step.",author:"Martin Luther King"},{text:"If you do what you’ve always done, you’ll get what you’ve always gotten.",author:"Tony Robbins"},{text:"It doesn’t matter how slowly you go, only that you do not stop.",author:"Confucius"},{text:"If we are facing in the right direction, all we have to do is keep on walking.",author:"Zen Proverb"},{text:"It does not matter how slowly you go as long as you do not stop.",author:"Confucius"}],D=()=>A[Math.floor(Math.random()*A.length)],nt=({controls:t})=>{const[o,s]=p.useState(D());p.useEffect(()=>{s(D())},[]);const r=o.text.split(" ");return e.jsxs(u,{textAlign:"center",sx:{display:"flex",flexDirection:"column",justifyContent:"center",flexGrow:1,padding:2},children:[e.jsx(f,{variant:"h3",gutterBottom:!0,children:e.jsx(u,{component:"span",display:"inline-block",children:r.map((i,l)=>e.jsx(S.span,{initial:{opacity:0,y:10},animate:t,transition:{delay:l*.15},style:{display:"inline-block",marginRight:"6px"},children:i},l))})}),e.jsx(S.div,{initial:{opacity:0},animate:t,transition:{delay:r.length*.15+.5},children:e.jsxs(f,{variant:"body1",color:"textSecondary",mt:1,children:["— ",o.author]})})]})};function rt(){const t=H(a=>a.user),o=M(a=>{var y;return(y=a.settings)==null?void 0:y.targetDuration}),s=d(a=>a.currentSession),r=d(a=>a.setCurrentSession),i=d(a=>a.loading),l=d(a=>a.setLoading),n=C(a=>a.updateSession),m=C(a=>a.addSession),c=async()=>{if(!(!t||!(s!=null&&s.id)||!o))try{l(!0);const a=$(s.createdAt.toDate()),y=b.getState().sessionGaps.data.find(x=>x.day===a),w=b.getState().dailySessions.data.find(x=>x.day===a),{session:k,previous:E,gapSummary:z}=await B(async x=>q(t.uid,s,o,x,y));b.getState().updateTodaySessionGapSummary(z);const P=((w==null?void 0:w.count)??0)+1;b.getState().updateTodayDailySession({day:a,count:P,updatedAt:U.now()}),n(E),m(k),r(k)}catch(a){console.error("Relapse failed:",a)}finally{l(!1)}},h="0.3em";return e.jsxs(L,{sx:{minHeight:"56px",position:"relative"},color:"secondary",onClick:c,disabled:i,"data-testid":"relapse-button",children:[e.jsx(u,{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",children:e.jsxs("span",{style:{fontFamily:"Roboto, sans-serif",letterSpacing:h,display:"inline-block"},children:["R",e.jsx("span",{style:{transform:"rotateY(180deg)",display:"inline-block",margin:`0 ${h} 0 -${h}`},children:"e"}),"lapse"]})}),e.jsx(u,{sx:{position:"absolute",right:24,top:"50%",transform:"translateY(-50%)",opacity:i?1:0,transition:"opacity 0.2s ease",pointerEvents:"none"},children:e.jsx(Q,{size:30})})]})}function it(){const t=H(n=>n.user),o=M(n=>n.settings),s=d(n=>n.setCurrentSession),r=d(n=>n.setLoading),i=C(n=>n.addSession),l=async()=>{if(!(!t||!(o!=null&&o.targetDuration)))try{r(!0);const n=await B(async m=>O(t.uid,o.targetDuration,m));s({...n}),i(n)}catch(n){console.error("Failed to start session:",n)}finally{r(!1)}};return e.jsx(L,{variant:"contained",color:"primary",onClick:l,"data-testid":"start-button",children:"Start Your Journey"})}const lt="_HomeContainer_az91x_1",ct="_ScrollContainer_az91x_10",ut="_ButtonContainer_az91x_20",j={HomeContainer:lt,ScrollContainer:ct,ButtonContainer:ut};function ft(){const t=d(c=>c.currentSession),o=d(c=>c.loading),s=d(c=>c.hasInitialized),r=v(),i=v(),l=v(),[n,m]=p.useState(!1);return p.useEffect(()=>{s&&m(!0)},[s]),p.useEffect(()=>{let c=!0;if(!n)return;const h=()=>{c&&(r.start({y:0,opacity:1}),setTimeout(()=>{c&&i.start({y:0,opacity:1})},200),setTimeout(()=>{c&&l.start({opacity:1})},1e3))},a=setTimeout(()=>{requestAnimationFrame(h)},0);return()=>{c=!1,clearTimeout(a)}},[n]),s?e.jsxs(u,{className:j.HomeContainer,children:[e.jsxs(u,{className:j.ScrollContainer,children:[e.jsx(S.div,{initial:{y:-20,opacity:0},animate:r,transition:{duration:.5,ease:"easeOut"},children:e.jsx(at,{})}),e.jsx(V,{}),e.jsx(nt,{controls:l})]}),e.jsx(u,{className:j.ButtonContainer,children:e.jsx(S.div,{initial:{y:40,opacity:0},animate:i,transition:{duration:.5,ease:"easeOut"},style:{width:"100%"},children:!o&&!t?e.jsx(it,{}):e.jsx(rt,{})})})]}):null}export{ft as default};
